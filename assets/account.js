(()=>{"use strict";function e(e=document.body,t){const s=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],n=t?"classList":"dataset";return s.reduce(((e,s)=>([].slice.call(t?s[n]:Object.entries(s[n])).forEach((n=>{let d;t&&n.slice(0,t.length)===t?d=n.slice(t.length,n.length):t||([d]=n),d&&(e[d]=e.hasOwnProperty(d)?e[d].constructor===Array?e[d].concat(s):[e[d],s]:s)})),e)),{})}function t(){return JSON.parse(document.querySelector("script#liquid-variables").innerHTML)}const s={login:window.component((t=>{const{loginForm:s,recoverPasswordForm:n,toggleRecoverPasswordBtns:d,recoverMessageSent:c,recoverPasswordSuccess:a,emailList:o}=e(t,null),r=()=>{s.classList.toggle("hidden"),n.classList.toggle("hidden")};d.forEach((e=>{e.addEventListener("click",r)}));const i=()=>{const e=document.querySelector(".errors");e&&(e.style.display="none")};o.forEach((e=>{e.addEventListener("focus",i),e.addEventListener("keyup",i)})),(()=>{const{hash:e}=window.location;return"#recover"===e})()&&!c&&r(),c&&(s.classList.add("hidden"),n.classList.add("hidden"),a.classList.remove("hidden"))})),account:window.component((t=>{const{addAddressButton:s,resetPageButton:n,editAddressButton:d,addAddress:c,info:a,addresses:o,editAddresses:r,editAddressForm:i,makeDefaultButton:l,links:u}=e(t,null),h=e=>{e.preventDefault(),a.classList.remove("hidden"),o.classList.remove("hidden"),c.classList.add("hidden"),r.classList.add("hidden"),[].concat(i).forEach((e=>e.classList.add("hidden"))),window.scrollTo(0,0)};s&&s.addEventListener("click",(e=>{e.preventDefault(),c.classList.remove("hidden"),a.classList.add("hidden"),o.classList.add("hidden"),window.scrollTo(0,0)})),n&&[].concat(n).forEach((e=>{e.addEventListener("click",h)})),d&&[].concat(d).forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const{addressId:s}=e.dataset;o.classList.add("hidden"),a.classList.add("hidden");const n=[].concat(i).find((e=>e.dataset.addressId===s));r.classList.remove("hidden"),n.classList.remove("hidden"),window.scrollTo(0,0)}))})),l&&[].concat(l).forEach((e=>{e.addEventListener("click",(e=>{const{addressId:t}=e.target.dataset,s=i.find((e=>e.dataset.addressId===t)).querySelector("form");s.querySelector('input[type="checkbox"]').click(),s.submit()}))})),window.location.href.includes("carts")&&u.forEach((e=>{const t=e.href.includes("carts");e.parentNode.classList[t?"remove":"add"]("text-grey-4")}))})),address:window.component((t=>{const{deleteAddressButton:s,deleteAddressModal:n,closeModal:d,deleteAddressConfirm:c}=e(t,null);d&&[].concat(d).forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),n.classList.remove("open")})))),s&&s.addEventListener("click",(e=>{e.preventDefault(),n.classList.add("open")})),c&&c.addEventListener("click",(()=>{document.getElementById(`delete-address-form--${c.dataset.addressId}`).submit()}))})),orders:window.component((async(s,n)=>{window.location.search.includes("menu=carts")||s.classList.remove("hidden");const{store:{store:d},customer:{secret:c,id:a}}=t(),{selectCustomer:o,ordersContainer:r,noOrders:i,customerSelectText:l,ordersTable:u,ordersTableRow:h,ordersBlockContainer:m,ordersBlock:L,orders:v}=e(s),p=({container:t,containerItem:s,orderList:n})=>{t.innerHTML="";const d=document.createDocumentFragment();n.forEach((t=>{const n=s.content.cloneNode(!0);Object.keys(t).forEach((s=>{const d=t[s];[].concat(e(n)[s]).filter(Boolean).forEach((e=>{e.innerText=d}))})),d.appendChild(n)})),t.appendChild(d)},f=async e=>{if(""===e)i.classList.add("hidden"),l.classList.remove("hidden"),v.classList.add("hidden");else{console.log("loadddd"),i.classList.add("hidden"),r.classList.add("hidden"),v.classList.add("is-active"),v.classList.remove("hidden"),l&&l.classList.add("hidden");const t=await(async e=>{const t=new URLSearchParams({store:d,secret:c,customerId:a,selectedCustomerId:e||""});return fetch(`https://karhu-b2b-functions.vercel.app/api/customer/get-store-customer-orders?${t}`).then((async e=>200===e.status?e.json():(console.error(`Could not fetch customer orders [${(await e.json()).message}]`),[])))})(e);if(v.classList.remove("is-active"),!t.length)return void i.classList.remove("hidden");r.classList.remove("hidden"),p({container:u,containerItem:h,orderList:t}),p({container:m,containerItem:L,orderList:t})}};if(o){const{select:t}=e(o);t.classList.add("is-loading"),t.disabled=!0,t.addEventListener("change",(e=>f(e.target.value))),n.on("agent-stores:received",((e,{data:s})=>{t.classList.add("is-active"),t.removeAttribute("disabled"),t.classList.remove("is-loading"),t.disabled=!1;const n=document.createDocumentFragment();s.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.innerText=e.name,n.appendChild(t)})),t.appendChild(n)}))}else f()})),accountCarts:window.component(((s,n)=>{window.location.search.includes("menu=carts")&&s.classList.remove("hidden");const{store:{store:d},customer:{secret:c,id:a}}=t(),{deleteCartBtn:o,deleteCartPopupBtn:r,cart:i,cartsLength:l,container:u,empty:h,viewCartBtn:m}=e(s,null),L=e=>{e.target.classList.toggle("is-active"),document.body.classList.toggle("pointer-events-none")};m&&[].concat(m).forEach((e=>e.addEventListener("click",(async e=>{})))),o&&[].concat(o).forEach((e=>e.addEventListener("click",(e=>{s.dataset.currentCart=e.currentTarget.dataset.name,n.emit("popup:open",null,"delete-cart")})))),r&&[].concat(r).forEach((e=>e.addEventListener("click",(async e=>{const t=s.dataset.currentCart,o=(e=>new URLSearchParams({store:d,secret:c,customerId:a,cartName:encodeURI(e)}))(t);L(e);try{await(e=>fetch(`https://karhu-b2b-functions.vercel.app/api/customer/delete-cart?${e}`,{method:"POST"}).then((async e=>{if(console.log(e.status),202===e.status)return e;throw new Error(e.message)})))(o),(e=>{[].concat(i).filter((t=>t.dataset.cart===e)).forEach((e=>e.remove()))})(t),0===(()=>{const e=parseFloat(l.innerText)-1;return l.innerText=e,e})()&&(h.classList.remove("hidden"),[].concat(u).forEach((e=>e.remove())))}catch(e){console.log(e)}finally{s.dataset.currentCart="",n.emit("popup:close",null,"delete-cart"),L(e)}}))))}))};window.app.add(s),window.app.mount()})();
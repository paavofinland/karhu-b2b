{%- comment -%}
  Expected behaviour:
    Renders country switcher

  About:
    Render a select list with country names

  Optional:
    - class: {String} Container classname
{%- endcomment -%}

{%- liquid
  assign ISOcurrent = shop.permanent_domain | remove: 'karhu-b2b-' | remove: '.myshopify.com' | remove: ' '
  assign ISOcodes = 'eu,us' | split: ','

  if ISOcurrent == 'dev' or ISOcurrent == 'stage'
    assign ISOcurrent = 'eu'
  endif

  assign url = 'country_url__'
  assign url = url | append: ISOcurrent
  assign currentURL = settings[url]

  assign url = 'country_name__'
  assign url = url | append: ISOcurrent
  assign currentName = settings[url]

  assign url = 'country_possesive__'
  assign url = url | append: ISOcurrent
  assign currentPossesive = settings[url]

  capture countriesName
    for iso in ISOcodes
      assign name = 'country_name__'
      assign name = name | append: iso
      unless settings[name] == ''
        echo settings[name]
        echo ','
      endunless
    endfor
  endcapture

  capture countriesPossesive
    for iso in ISOcodes
      assign possesive = 'country_possesive__'
      assign possesive = possesive | append: iso
      unless settings[possesive] == ''
        echo settings[possesive]
        echo ','
      endunless
    endfor
  endcapture

  capture countriesURL
    for iso in ISOcodes
      assign url = 'country_url__'
      assign url = url | append: iso
      unless settings[name] == ''
        echo settings[url]
        echo ','
      endunless
    endfor
  endcapture

  assign countriesName = countriesName | split: ','
  assign countriesURL = countriesURL | split: ','
  assign countriesPossesive = countriesPossesive | split: ','
-%}
{% form 'localization' %}
  <select name='country_code'>
    {% for country in localization.available_countries %}
      <option
        value='{{ country.currency.iso_code }}'
        {%- if country == localization.country %}
          selected='selected'
        {% endif %}
      >
        {{ country.name }} ({{ country.currency.iso_code }}) - {{ country.currency.symbol }}
      </option>
    {% endfor %}
  </select>

  <input type='submit' value='Update'>
{% endform %}

(()=>{"use strict";function e(e=document.body,t){const s=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],d=t?"classList":"dataset";return s.reduce(((e,s)=>([].slice.call(t?s[d]:Object.entries(s[d])).forEach((d=>{let n;t&&d.slice(0,t.length)===t?n=d.slice(t.length,d.length):t||([n]=d),n&&(e[n]=e.hasOwnProperty(n)?e[n].constructor===Array?e[n].concat(s):[e[n],s]:s)})),e)),{})}const t=window.component((t=>{const{loginForm:s,recoverPasswordForm:d,toggleRecoverPasswordBtns:n,recoverMessageSent:a,recoverPasswordSuccess:o,emailList:c}=e(t,null),r=()=>{s.classList.toggle("hidden"),d.classList.toggle("hidden")};n.forEach((e=>{e.addEventListener("click",r)}));const i=()=>{const e=document.querySelector(".errors");e&&(e.style.display="none")};c.forEach((e=>{e.addEventListener("focus",i),e.addEventListener("keyup",i)})),(()=>{const{hash:e}=window.location;return"#recover"===e})()&&!a&&r(),a&&(s.classList.add("hidden"),d.classList.add("hidden"),o.classList.remove("hidden"))})),s=window.component((t=>{const{addAddressButton:s,resetPageButton:d,editAddressButton:n,addAddress:a,info:o,addresses:c,editAddresses:r,editAddressForm:i,makeDefaultButton:l,tabLink:h,tab:u}=e(t,null),m=[].concat(u).filter(Boolean),L=[].concat(h).filter(Boolean),p=m.map((e=>e.dataset.tab)),v=new URLSearchParams(window.location.search).get("t"),f=v&&p.includes(v)?v:p[0];m.forEach((e=>e.classList[f===e.dataset.tab?"remove":"add"]("hidden"))),L.forEach((e=>e.classList[f===e.dataset.tabLink?"add":"remove"]("is-active")));const w=e=>{e.preventDefault(),o.classList.remove("hidden"),c.classList.remove("hidden"),a.classList.add("hidden"),r.classList.add("hidden"),[].concat(i).forEach((e=>e.classList.add("hidden"))),window.scrollTo(0,0)};s&&s.addEventListener("click",(e=>{e.preventDefault(),a.classList.remove("hidden"),o.classList.add("hidden"),c.classList.add("hidden"),window.scrollTo(0,0)})),d&&[].concat(d).forEach((e=>{e.addEventListener("click",w)})),n&&[].concat(n).forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const{addressId:s}=e.dataset;c.classList.add("hidden"),o.classList.add("hidden");const d=[].concat(i).find((e=>e.dataset.addressId===s));r.classList.remove("hidden"),d.classList.remove("hidden"),window.scrollTo(0,0)}))})),l&&[].concat(l).forEach((e=>{e.addEventListener("click",(e=>{const{addressId:t}=e.target.dataset,s=i.find((e=>e.dataset.addressId===t)).querySelector("form");s.querySelector('input[type="checkbox"]').click(),s.submit()}))}))})),d=window.component((t=>{const{deleteAddressButton:s,deleteAddressModal:d,closeModal:n,deleteAddressConfirm:a}=e(t,null);n&&[].concat(n).forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),d.classList.remove("open")})))),s&&s.addEventListener("click",(e=>{e.preventDefault(),d.classList.add("open")})),a&&a.addEventListener("click",(()=>{document.getElementById(`delete-address-form--${a.dataset.addressId}`).submit()}))})),n=async(e,t)=>fetch(`https://karhu-b2b-functions.vercel.app/api${e}`,t).then((async e=>{const t=await(async e=>e.json().catch((e=>null)))(e);if(!e.ok||e.status>=400&&e.status<500&&404!==e.status)throw Error(t.message||"Something went wrong, please try again later.");return t})).catch((t=>{throw console.info(`⚡️⚠️ Function error [${e}]`),t}));function a(){return JSON.parse(document.querySelector("script#liquid-variables").innerHTML)}const o={login:t,account:s,address:d,accountOrders:window.component((async(t,s)=>{const{store:{store:d,currencies:o},customer:{secret:c,id:r}}=a(),{selectCustomer:i,selectOrderSorting:l,ordersContainer:h,noOrders:u,customerSelectText:m,ordersTable:L,ordersTableRow:p,ordersBlockContainer:v,ordersBlock:f,orders:w}=e(t),g=({container:t,containerItem:s,orderList:d})=>{t.innerHTML="";const n=document.createDocumentFragment();d.forEach((t=>{const d=s.content.cloneNode(!0);Object.entries(t).map((([e,t])=>"currencyCode"===e?[e,o.find((({iso_code:e})=>e===t))?.symbol||t]:[e,t])).forEach((([t,s])=>{[].concat(e(d)[t]).filter(Boolean).forEach((e=>{e instanceof HTMLAnchorElement?e.href=s:e.innerText=s}))})),n.appendChild(d)})),t.appendChild(n)},E=async e=>{if(""===e)u.classList.add("hidden"),m.classList.remove("hidden"),w.classList.add("hidden");else{u.classList.add("hidden"),h.classList.add("hidden"),w.classList.add("is-active"),w.classList.remove("hidden"),m&&m.classList.add("hidden");const t=await(async e=>{const[t,s]=l.value.split("-"),a=new URLSearchParams({store:d,secret:c,customerId:r,selectedCustomerId:e?.id||"",selectedCustomerShopifyId:e?.shopifyId||"",sortKey:t,reverse:s});return n(`/customer/get-store-customer-orders?${a}`).then((e=>"TOTAL_PRICE"===t?e.sort(((e,t)=>((e,t,s)=>{const d=parseFloat(e.price.replaceAll(".","")),n=parseFloat(t.price.replaceAll(".",""));return s?n-d:d-n})(e,t,!!Number(s)))):e)).catch((e=>(console.info("[unhandled error]"),[])))})(e);if(w.classList.remove("is-active"),!t.length)return void u.classList.remove("hidden");h.classList.remove("hidden"),g({container:L,containerItem:p,orderList:t}),g({container:v,containerItem:f,orderList:t})}};if(i){const{select:t}=e(i);t.classList.add("is-loading"),t.disabled=!0,t.addEventListener("change",(e=>{const{value:t,options:s,selectedIndex:d}=e.target;E({id:t,shopifyId:s[d].dataset.shopifyId})})),s.on("agent-stores:received",((e,{data:s})=>{t.classList.add("is-active"),t.removeAttribute("disabled"),t.classList.remove("is-loading"),t.disabled=!1;const d=document.createDocumentFragment();s.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.dataset.shopifyId=e.shopifyId,t.innerText=e.name,d.appendChild(t)})),t.appendChild(d)})),l.addEventListener("change",(()=>{const{value:e,options:s,selectedIndex:d}=t;E({id:e,shopifyId:s[d].dataset.shopifyId})}))}else E(),l.addEventListener("change",(()=>{E()}))})),accountCartTemplates:window.component(((t,s)=>{window.location.search.includes("menu=carts")&&t.classList.remove("hidden");const{store:{store:d},customer:{secret:o,id:c}}=a(),{deleteCartBtn:r,deleteCartPopupBtn:i,cart:l,cartsLength:h,cartsCount:u,container:m,empty:L}=e(t,null),p=e=>{e.target.classList.toggle("is-active"),document.body.classList.toggle("pointer-events-none")};r&&[].concat(r).forEach((e=>e.addEventListener("click",(e=>{i.dataset.id=e.currentTarget.dataset.id,s.emit("popup:open",null,"delete-cart")})))),i&&i.addEventListener("click",(async e=>{const t=i.dataset.id,a=(e=>new URLSearchParams({store:d,secret:o,customerId:c,cartId:encodeURI(e)}))(t);p(e),await n(`/customer/delete-cart?${a}`,{method:"POST"}).catch((e=>{console.info("[unhandled error]")})),(e=>{[].concat(l).filter((t=>t.dataset.cart===e)).forEach((e=>e.remove()))})(t),0===(()=>{const e=parseFloat(h.innerText)-1;return e>0?h.innerText=e:u.classList.add("hidden"),e})()&&(L.classList.remove("hidden"),[].concat(m).forEach((e=>e.remove()))),i.dataset.id="",s.emit("popup:close",null,"delete-cart"),p(e)}))}))};window.app.add(o),window.app.mount()})();
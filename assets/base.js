(()=>{"use strict";const e=e=>new Promise((t=>{window?.hasLoaded?.scripts?.[e]?t():window.app.on(`${e}:loaded`,t)}));function t(e=document.body,t){const n=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],s=t?"classList":"dataset";return n.reduce(((e,n)=>([].slice.call(t?n[s]:Object.entries(n[s])).forEach((s=>{let o;t&&s.slice(0,t.length)===t?o=s.slice(t.length,s.length):t||([o]=s),o&&(e[o]=e.hasOwnProperty(o)?e[o].constructor===Array?e[o].concat(n):[e[o],n]:n)})),e)),{})}const n={hero:window.component((async n=>{const{slider:s,slide:o,prev:a,next:i}=t(n,null);if(o.length>1){await e("Swiper");const t=new Swiper(s,{slidesPerView:1,loop:!0,on:{afterInit:e=>{e.wrapperEl.classList.remove("overflow-hidden","flex")}}});a.addEventListener("click",(()=>t.slidePrev())),i.addEventListener("click",(()=>t.slideNext()))}})),cart:window.component((async e=>{const{editItemBtn:n,sidebar:s,sidebarLayer:o,closeSidebarBtn:a,saveCartBtn:i,popup:r,closePopupBtn:d}=t(e),c=Array.isArray(s)?Array.from(s):[s],l=e=>{const{id:t}=e.currentTarget.dataset;var n;c.find((n=t,e=>e.dataset.id===n)).classList.toggle("is-active"),o.classList.toggle("is-active"),document.body.classList.toggle("overflow-hidden")};n.addEventListener("click",l),a.addEventListener("click",l),o.addEventListener("click",l);const p=()=>r.classList.toggle("hidden");i.addEventListener("click",p),d.forEach((e=>e.addEventListener("click",p)))})),categoryOverview:window.component((async n=>{const{slider:s}=t(n,null);return await e("Swiper"),new Swiper(s,{slidesPerView:1.4,spaceBetween:16,slidesOffsetBefore:16,slidesOffsetAfter:16,breakpoints:{768:{slidesPerView:2.2,spaceBetween:16,slidesOffsetBefore:16,slidesOffsetAfter:16},1024:{slidesPerView:2.4,spaceBetween:60,slidesOffsetBefore:0,slidesOffsetAfter:0},1440:{slidesPerView:3,spaceBetween:60,slidesOffsetBefore:0,slidesOffsetAfter:0}}})}))},s=window.component((()=>{document.addEventListener("shopify:section:load",(()=>{window.app.unmount(),window.app.mount()}))})),o=window.component((e=>{const{text:t}=e.dataset;console.log("console:log",t)})),a=window.component(((e,n)=>{const{group:s}=e.dataset,{inner:o,toggle:a,shrinkBtn:i,expandBtn:r,toggleModalBtn:d}=t(e,null),c="is-active",l=()=>{e.style.setProperty("--innerHeight","auto"),e.style.setProperty("--innerHeight",`${o.scrollHeight}px`)};l(),window.addEventListener("resize",l,{passive:!0}),a.addEventListener("click",(()=>{n.emit("accordion:toggle",null,{open:!e.classList.contains(c),node:e,group:s})})),d&&d.addEventListener("click",(e=>{n.emit("modal:open",{type:e.target.dataset.modalType})})),n.on("accordion:toggle",((t,n={})=>{s===n.group&&(e.classList[n.open&&n.node===e?"add":"remove"](c),i.classList.toggle("hidden"),i.classList.toggle("flex"),r.classList.toggle("hidden"),r.classList.toggle("block"))}))})),i=window.component((e=>{const{hamburger:n,hamburgerOpened:s,hamburgerClosed:o,mobileMenu:a,main:i}=t(e),{clear:r}=e.dataset,d=document.querySelector("#shopify-section-announcement-bar").offsetHeight||0,c=()=>{void 0!==r&&i.classList[!s.classList.contains("hidden")||window.scrollY>d?"add":"remove"]("is-active")};window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("load",c),n.addEventListener("click",(()=>{s.classList.toggle("hidden"),o.classList.toggle("hidden"),document.body.classList.toggle("overflow-hidden"),a.classList.toggle("left-0"),c()}));const l=()=>{a.style.height=window.innerHeight-d-a.parentElement.offsetHeight+"px"};l(),window.addEventListener("resize",l)}));const r=({keyCode:e},{type:t,boolean:n})=>{27===e&&t&&n&&window.app.emit(t,{[n]:!1})},d=window.component((async(e,n)=>{const s=e.parentNode,o=e,{toggle:a,clear:i,focusEl:d}=t(e,null),c=({cartOpen:t})=>{e.classList[t?"add":"remove"]("open"),t?(o.tabIndex="0",(d||e).focus()):o.tabIndex="-1"};return a.forEach((e=>{e.addEventListener("click",(()=>n.emit("cart:toggle",(({cartOpen:e})=>({cartOpen:!e??!0})))))})),c(n.getState()),i&&i.addEventListener("click",(()=>(window.app.emit("cart:updating"),fetch(`${window.Phill.routes.cartClear}.js`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:"cart-drawer"})}).then((e=>e.json())).then((e=>(window.app.emit(["cart:updated","cart:render"],{cart:e}),e)))))),e.addEventListener("keyup",(e=>r(e,{type:"cart:toggle",boolean:"cartOpen"}))),await n.on("cart:render",(({cart:e})=>{s&&(document.getElementById("shopify-section-cart-drawer").outerHTML=e.sections["cart-drawer"]),window.app.unmount(),window.app.mount()})),n.on("cart:toggle",c),()=>{n.on(["cart:toggle","cart:render"],(()=>{}))(),e.removeEventListener("keyup",(e=>r(e,{type:"cart:toggle",boolean:"cartOpen"})))}})),c=window.component((e=>{const{update:n}=t(e,null),{key:s}=e.dataset;[].concat(n).forEach((e=>{const{value:t}=e.dataset;e.addEventListener("click",(()=>function(e,t){return function(e,t){return window.app.emit("cart:updating"),fetch(`${window.Phill.routes.cartChange}.js`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:t,sections:"cart-drawer"})}).then((e=>e.json())).then((async e=>(window.app.emit(["cart:updated","cart:render"],{cart:e}),e)))}(e,t)}(s,t)))}))})),l="agent-stores:loading",p={sectionRendering:s,consoleLog:o,accordion:a,header:i,cartDrawer:d,cartItem:c,announcementBar:window.component((async(e,n)=>{const{selectCustomer:s}=t(e,null),{select:o}=t(s,null),{customerId:a,customerSecret:i,store:r,selectedStoreCustomer:d}=e.dataset;if(!(a&&i&&r&&s))return;n.on(l,((e,t=!0)=>{s.classList[t?"add":"remove"]("is-loading")})),n.emit(l,null,!0);const c=new URLSearchParams({store:r,customerId:a,secret:i}),p=await fetch(`https://karhu-b2b-functions.vercel.app/api/customer/list-agent-stores?${c}`).then((async e=>{if(200===e.status){const t=await e.json();return n.emit("agent-stores:received",null,{data:t}),t}return console.error(`Could not fetch agent stores [${(await e.json()).message}]`),[]}));n.emit(l,null,!1),p.length?((e=>{const t=document.createDocumentFragment();e.forEach((e=>{const n=document.createElement("option");d===e.id&&n.setAttribute("selected",!0),n.value=e.id,n.innerText=e.name,t.appendChild(n)})),o.appendChild(t)})(p),o.addEventListener("change",(async e=>{n.emit(l,null,!0),await fetch(`https://karhu-b2b-functions.vercel.app/api/customer/set-selected-store?${c}&storeCustomerId=${e.target.value}`).then((async e=>{201===e.status?window.location.reload():console.error(`Could not set selected store [${(await e.json()).message}]`)})),n.emit(l,null,!1)})),n.emit("store-data:send",null,{data:e.dataset})):o.setAttribute("disabled",!0)})),modal:window.component(((e,n)=>{const{closeModalBtn:s}=t(e,null),o=()=>{e.classList.toggle("flex"),e.classList.toggle("hidden"),document.body.classList.toggle("overflow-hidden")};e.addEventListener("click",(e=>{e.target.dataset.modalType&&o()}),{capture:!0}),s.addEventListener("click",o),n.on("modal:open",(t=>{e.dataset.modalType===t.type&&o()}))})),countrySelect:window.component((e=>{const{select:n}=t(e),s=new URLSearchParams(window.location.search).get("country_code"),o=n.dataset.current;s&&s!==o&&(n.value=s,n.form.submit()),n.addEventListener("change",(e=>{const t=e.target.options[e.target.selectedIndex];t.dataset.url?window.location.href=`${t.dataset.url}?country_code=${t.value}`:e.target.form.submit()}))}))};window.app.add(n),window.app.add(p),window.app.mount()})();
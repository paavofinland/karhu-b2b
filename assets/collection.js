(()=>{"use strict";const t=t=>history.pushState({searchParams:t},"",`${window.location.pathname}${t.includes("?")||!t?t:"?".concat(t)}`);function n(t=document.body,n){const e=[...t.querySelectorAll(n?`[class*="${n}"]`:"*")],o=n?"classList":"dataset";return e.reduce(((t,e)=>([].slice.call(n?e[o]:Object.entries(e[o])).forEach((o=>{let i;n&&o.slice(0,n.length)===n?i=o.slice(n.length,o.length):n||([i]=o),i&&(t[i]=t.hasOwnProperty(i)?t[i].constructor===Array?t[i].concat(e):[t[i],e]:e)})),t)),{})}const e=window.component(((e,o)=>{const{filtersForm:i,input:r,clearButton:a,clearAllButton:c,toggleFiltersButton:s,sidebarFilters:l}=n(e),d=[].concat(r).filter(Boolean),u=[].concat(a).filter(Boolean),m=[].concat(s).filter(Boolean);let w=l.classList.contains("is-active");const h=async t=>{const n=new URLSearchParams(window.location.search).get("sort_by"),e=[...n?[["sort_by",n]]:[]],i=t?Array.from(new FormData(t).entries()):[];o.emit("product:loading",null,{isLoading:!0});const r=new URLSearchParams([...i,...e]).toString(),{"main-collection":a}=await fetch(`${window.location.origin+window.location.pathname}?sections=main-collection&${r}`).then((t=>t.json()));o.emit("filter:render",{html:(new DOMParser).parseFromString(a,"text/html"),uri:r})};c&&c.addEventListener("click",(()=>h())),d.forEach((t=>t.addEventListener("change",(t=>h(t.target.form))))),u.forEach((t=>t.addEventListener("click",(()=>{d.filter((({name:n})=>n===t.dataset.name)).forEach((t=>{t.checked=!1})),h()})))),m.forEach((t=>t.addEventListener("click",(()=>o.emit("filters:toggle",null,!w)))));const p=(t,e)=>{const{sidebarFilters:o,overlay:i}=n(t);[o,i].forEach((t=>t.classList[e?"add":"remove"]("is-active")))};o.on("filter:render",(({html:i,uri:r})=>{o.emit("product:update",null,{html:i});const a=n(i).filters;p(a,!0),e.outerHTML=a.outerHTML,o.emit("product:loading",null,{isLoading:!1}),t(r),window.app.unmount(),window.app.mount()})),o.on("product:loading",((t,{isLoading:n})=>{i.classList[n?"add":"remove"]("is-loading")})),o.on("filters:toggle",((t,n)=>{w=n,p(e,n),document.body.classList[n?"add":"remove"]("overflow-hidden")}))})),o=()=>Number(new URLSearchParams(window.location.search).get("page")||1),i={collectionFilters:e,mainCollection:window.component(((e,i)=>{const{loadMore:r,productGrid:a,sortByOptions:c,sortByContainer:s,container:l}=n(e);i.on("product:update",((t,{html:e})=>{a.innerHTML=n(e).productGrid.innerHTML}));const d=async t=>{const e=o(),i=t||e+1,a=((t,n)=>{const e=new URLSearchParams(window.location.search);return e.set("page",t),e.set("sort_by",n),e.toString()})(i,c.value),s=await(async t=>fetch(t).then((t=>t.text())).then((t=>(new DOMParser).parseFromString(t,"text/html"))))(`${window.location.origin+window.location.pathname}?section_id=main-collection&${a}`);r.classList.add("opacity-0");const{empty:l}=n(s,null);if(l)return;const d=1===i;window.app.emit(["product:render"],{html:s,uri:a,addProducts:!d})},u=new IntersectionObserver((t=>{t.forEach((async t=>{t.isIntersecting&&(r.classList.remove("active"),d())}))}),{rootMargin:"0px",threshold:0});r&&u.observe(r),1!==o()&&window.addEventListener("load",(()=>{d(1),setTimeout((()=>window.scrollTo(0,0)),100)})),i.on("product:render",(({html:e,uri:o,addProducts:r=!1})=>{const{productGrid:c}=n(e,null);r?a.innerHTML+=c.innerHTML:a.innerHTML=c.innerHTML,t(o),i.emit("product:loading",null,{isLoading:!1})})),i.on("product:loading",((t,{isLoading:n})=>{[l,s,a].forEach((t=>t.classList[n?"add":"remove"]("is-loading")))})),c.addEventListener("change",(()=>{i.emit("product:loading",null,{isLoading:!0}),d(1)}))}))};window.app.add(i),window.app.mount()})();
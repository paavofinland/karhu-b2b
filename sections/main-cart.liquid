{%- include 'function.agent' -%}

<section
  data-component='cart'
  class='container px-4 mt-[83px] lg:mt-[128px] mb-[60px] lg:mb-[100px]'
>
  <div class='max-w-[720px] mx-auto'>
    <div class='flex lg:mb-10 flex-col lg:flex-row justify-between lg:items-center'>
      <h4 class='text-heading-4 lg:text-heading-3 mb-7 lg:mb-0'>
        {{- 'cart.general.title' | t -}}
      </h4>
      {%- if agent -%}
        {%- render 'component.select',
          options: null,
          placeholder_class: 'text-grey-3',
          container_class: 'border border-grey-4 w-full lg:max-w-[300px] mb-7 lg:mb-0',
          select_class: 'px-4 py-[18px] w-full appearance-none',
          placeholder: 'Select Saved Cart'
        -%}
      {%- endif -%}
    </div>
    {%- if cart.items.size > 0 -%}
      <div class='text-body-sm'>
        {%- for item in cart.items -%}
          <div class='flex justify-between gap-4 lg:gap-[60px] pb-3 lg:pb-5 border-b border-b-grey-5'>
            <div class='min-w-[62px] lg:min-w-[120px] w-min bg-grey-6 aspect-square'>
              {%- render 'component.image',
                img: item.image,
                class: 'aspect-square object-contain mix-blend-darken'
              -%}
            </div>
            <div class='w-[fill-available] lg:self-center'>
              <div class='flex justify-between'>
                <p title='{{- item.title -}}' class='max-w-[190px] lg:max-w-[420px] mr-4 truncate'>
                  {{- item.title -}}
                </p>
                <p>{{- item.price | money -}}</p>
              </div>
              <div class='flex justify-between mt-1 lg:mt-2'>
                <p class='text-body-xs'>
                  <span class='text-grey-3'>
                    {{- cart.product_item.quantity -}}
                    :
                  </span>
                  {{- item.quantity -}}
                </p>
                <div>
                  <button
                    data-edit-item-btn
                    data-id='{{- item.id -}}'
                    class='mr-2 underline'
                  >
                    {{- cart.product_item.edit -}}
                  </button>
                  <a class='underline' href='{{ item.url_to_remove }}'>
                    {{- cart.product_item.remove -}}
                  </a>
                </div>
              </div>
            </div>
          </div>
          <div
            data-sidebar
            data-id='{{- item.id -}}'
            class='translate-x-full transition-transform duration-300 flex-col fixed top-0 right-0 bottom-0 h-full w-[355px] lg:w-[600px] z-20 bg-white p-4 lg:py-7 lg:px-[60px] is-active:-translate-x-0'
          >
            <button
              data-close-sidebar-btn
              data-id='{{- item.id -}}'
              class='absolute p-3 rounded-full border border-grey-5 top-4 right-4 lg:right-7 lg:top-7'
            >
              {%- render 'component.icon', type: 'close' -%}
            </button>
            <div class='flex gap-4 lg:gap-7 border-b border-b-grey-4 pt-6 lg:pt-5 pb-5 lg:pb-7'>
              <div class='min-w-[110px] lg:min-w-[120px] w-min bg-grey-6 aspect-square'>
                {%- render 'component.image',
                  img: item.image,
                  class: 'aspect-square object-contain mix-blend-darken'
                -%}
              </div>
              <div class='self-center'>
                <p>{{- item.title -}}</p>
                <p class='text-detailed text-grey-3'>{{- item.metafields.color.value -}}</p>
                <p class='mt-2'>{{- item.price | money -}}</p>
              </div>
            </div>
            <div class='flex flex-col justify-between h-full'>
              {%- render 'product-sizes', product: item -%}
              {%- render 'component.button',
                style: 'primary',
                text: 'Update order',
                class: 'w-full mt-4'
              -%}
            </div>
          </div>
        {%- endfor -%}
        <div class='flex justify-between text-body-lg my-10 lg:mt-[60px]'>
          <p>Subtotal</p>
          <p>{{- cart.total_price | money -}}</p>
        </div>
        <div>
          <div class='flex gap-2 lg:gap-4'>
            {%- render 'component.button', text: 'Share', style: 'secondary', class: 'w-full' -%}
            {%- render 'component.button', text: 'Save', style: 'secondary', class: 'w-full', attributes: 'data-save-cart-btn data-id="{{- item.id -}}"' -%}
          </div>
          {%- render 'component.button',
            text: 'Go to checkout',
            style: 'primary',
            class: 'w-full mt-2 lg:mt-4'
          -%}
        </div>
      </div>
    {%- else -%}
      <div>
        <p class='mb-7 lg:mb-9'>{{- 'cart.general.empty' | t -}}</p>
        {%- render 'component.button',
          text: 'cart.general.go_shopping',
          style: 'primary',
          class: 'px-8 lg:px-12 inline-block',
          href: '/'
        -%}
      </div>
    {%- endif -%}
  </div>
  <div
    data-sidebar-layer
    class='fixed transition-opacity w-full duration-300 h-full opacity-0 inset-0 bg-[#1E1E1E] bg-opacity-50 z-10 pointer-events-none is-active:pointer-events-auto is-active:opacity-100'
  ></div>
  {%- render 'component.popup',
    content_snippet: 'cart.save-popup.content',
    footer_snippet: 'cart.save-popup.footer',
    title: 'Save cart'
  -%}
</section>

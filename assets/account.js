(()=>{"use strict";function e(e=document.body,t){const s=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],n=t?"classList":"dataset";return s.reduce(((e,s)=>([].slice.call(t?s[n]:Object.entries(s[n])).forEach((n=>{let a;t&&n.slice(0,t.length)===t?a=n.slice(t.length,n.length):t||([a]=n),a&&(e[a]=e.hasOwnProperty(a)?e[a].constructor===Array?e[a].concat(s):[e[a],s]:s)})),e)),{})}const t=window.component((t=>{const{loginForm:s,recoverPasswordForm:n,toggleRecoverPasswordBtns:a,recoverMessageSent:d,recoverPasswordSuccess:c,emailList:r}=e(t,null),o=()=>{s.classList.toggle("hidden"),n.classList.toggle("hidden")};a.forEach((e=>{e.addEventListener("click",o)}));const i=()=>{const e=document.querySelector(".errors");e&&(e.style.display="none")};r.forEach((e=>{e.addEventListener("focus",i),e.addEventListener("keyup",i)})),(()=>{const{hash:e}=window.location;return"#recover"===e})()&&!d&&o(),d&&(s.classList.add("hidden"),n.classList.add("hidden"),c.classList.remove("hidden"))})),s=window.component((t=>{const{addAddressButton:s,resetPageButton:n,editAddressButton:a,addAddress:d,info:c,addresses:r,editAddresses:o,editAddressForm:i,makeDefaultButton:l,tabLink:u,tab:h}=e(t,null),m=[].concat(h).filter(Boolean),L=[].concat(u).filter(Boolean),v=m.map((e=>e.dataset.tab)),p=new URLSearchParams(window.location.search).get("t"),f=p&&v.includes(p)?p:v[0];m.forEach((e=>e.classList[f===e.dataset.tab?"remove":"add"]("hidden"))),L.forEach((e=>e.classList[f===e.dataset.tabLink?"add":"remove"]("is-active")));const w=e=>{e.preventDefault(),c.classList.remove("hidden"),r.classList.remove("hidden"),d.classList.add("hidden"),o.classList.add("hidden"),[].concat(i).forEach((e=>e.classList.add("hidden"))),window.scrollTo(0,0)};s&&s.addEventListener("click",(e=>{e.preventDefault(),d.classList.remove("hidden"),c.classList.add("hidden"),r.classList.add("hidden"),window.scrollTo(0,0)})),n&&[].concat(n).forEach((e=>{e.addEventListener("click",w)})),a&&[].concat(a).forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const{addressId:s}=e.dataset;r.classList.add("hidden"),c.classList.add("hidden");const n=[].concat(i).find((e=>e.dataset.addressId===s));o.classList.remove("hidden"),n.classList.remove("hidden"),window.scrollTo(0,0)}))})),l&&[].concat(l).forEach((e=>{e.addEventListener("click",(e=>{const{addressId:t}=e.target.dataset,s=i.find((e=>e.dataset.addressId===t)).querySelector("form");s.querySelector('input[type="checkbox"]').click(),s.submit()}))}))})),n=window.component((t=>{const{deleteAddressButton:s,deleteAddressModal:n,closeModal:a,deleteAddressConfirm:d}=e(t,null);a&&[].concat(a).forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),n.classList.remove("open")})))),s&&s.addEventListener("click",(e=>{e.preventDefault(),n.classList.add("open")})),d&&d.addEventListener("click",(()=>{document.getElementById(`delete-address-form--${d.dataset.addressId}`).submit()}))})),a=async(e,t)=>fetch(`https://karhu-b2b-functions.vercel.app/api${e}`,t).then((async e=>{const t=await(async e=>e.json().catch((e=>null)))(e);if(!e.ok||e.status>=400&&e.status<500&&404!==e.status)throw Error(t.message||"Something went wrong, please try again later.");return t})).catch((t=>{throw console.info(`⚡️⚠️ Function error [${e}]`),t}));function d(){return JSON.parse(document.querySelector("script#liquid-variables").innerHTML)}const c={login:t,account:s,address:n,accountOrders:window.component((async(t,s)=>{const{store:{store:n,currencies:c},customer:{secret:r,id:o}}=d(),{selectCustomer:i,selectOrderSorting:l,ordersContainer:u,noOrders:h,customerSelectText:m,ordersTable:L,ordersTableRow:v,ordersBlockContainer:p,ordersBlock:f,orders:w}=e(t),g=({container:t,containerItem:s,orderList:n})=>{t.innerHTML="";const a=document.createDocumentFragment();n.forEach((t=>{const n=s.content.cloneNode(!0);Object.entries(t).map((([e,t])=>"currencyCode"===e?[e,c.find((({iso_code:e})=>e===t))?.symbol||t]:[e,t])).forEach((([t,s])=>{[].concat(e(n)[t]).filter(Boolean).forEach((e=>{e instanceof HTMLAnchorElement?e.href=s:e.innerText=s}))})),a.appendChild(n)})),t.appendChild(a)},E=async e=>{if(""===e)h.classList.add("hidden"),m.classList.remove("hidden"),w.classList.add("hidden");else{h.classList.add("hidden"),u.classList.add("hidden"),w.classList.add("is-active"),w.classList.remove("hidden"),m&&m.classList.add("hidden");const t=await(async e=>{const[t,s]=l.value.split("-"),d=new URLSearchParams({store:n,secret:r,customerId:o,selectedCustomerId:e||"",sortKey:t,reverse:s});return a(`/customer/get-store-customer-orders?${d}`).then((e=>"TOTAL_PRICE"===t?e.sort(((e,t)=>((e,t,s)=>{const n=parseFloat(e.price.replaceAll(".","")),a=parseFloat(t.price.replaceAll(".",""));return s?a-n:n-a})(e,t,!!Number(s)))):e)).catch((e=>(console.info("[unhandled error]"),[])))})(e);if(w.classList.remove("is-active"),!t.length)return void h.classList.remove("hidden");u.classList.remove("hidden"),g({container:L,containerItem:v,orderList:t}),g({container:p,containerItem:f,orderList:t})}};if(i){const{select:t}=e(i);t.classList.add("is-loading"),t.disabled=!0,t.addEventListener("change",(e=>E(e.target.value))),s.on("agent-stores:received",((e,{data:s})=>{t.classList.add("is-active"),t.removeAttribute("disabled"),t.classList.remove("is-loading"),t.disabled=!1;const n=document.createDocumentFragment();s.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.innerText=e.name,n.appendChild(t)})),t.appendChild(n)})),l.addEventListener("change",(()=>{E(t.value)}))}else E(),l.addEventListener("change",(()=>{E()}))})),accountCartTemplates:window.component(((t,s)=>{window.location.search.includes("menu=carts")&&t.classList.remove("hidden");const{store:{store:n},customer:{secret:c,id:r}}=d(),{deleteCartBtn:o,deleteCartPopupBtn:i,cart:l,cartsLength:u,cartsCount:h,container:m,empty:L}=e(t,null),v=e=>{e.target.classList.toggle("is-active"),document.body.classList.toggle("pointer-events-none")};o&&[].concat(o).forEach((e=>e.addEventListener("click",(e=>{i.dataset.id=e.currentTarget.dataset.id,s.emit("popup:open",null,"delete-cart")})))),i&&i.addEventListener("click",(async e=>{const t=i.dataset.id,d=(e=>new URLSearchParams({store:n,secret:c,customerId:r,cartId:encodeURI(e)}))(t);v(e),await a(`/customer/delete-cart?${d}`,{method:"POST"}).catch((e=>{console.info("[unhandled error]")})),(e=>{[].concat(l).filter((t=>t.dataset.cart===e)).forEach((e=>e.remove()))})(t),0===(()=>{const e=parseFloat(u.innerText)-1;return e>0?u.innerText=e:h.classList.add("hidden"),e})()&&(L.classList.remove("hidden"),[].concat(m).forEach((e=>e.remove()))),i.dataset.id="",s.emit("popup:close",null,"delete-cart"),v(e)}))}))};window.app.add(c),window.app.mount()})();
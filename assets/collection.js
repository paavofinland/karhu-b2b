(()=>{"use strict";const t=t=>history.pushState({searchParams:t},"",`${window.location.pathname}${t.includes("?")||!t?t:"?".concat(t)}`);function n(t=document.body,n){const e=[...t.querySelectorAll(n?`[class*="${n}"]`:"*")],o=n?"classList":"dataset";return e.reduce(((t,e)=>([].slice.call(n?e[o]:Object.entries(e[o])).forEach((o=>{let i;n&&o.slice(0,n.length)===n?i=o.slice(n.length,o.length):n||([i]=o),i&&(t[i]=t.hasOwnProperty(i)?t[i].constructor===Array?t[i].concat(e):[t[i],e]:e)})),t)),{})}const e=()=>{window.app.unmount(),window.app.mount()},o=window.component(((o,i)=>{const{filtersForm:r,input:a,clearButton:c,clearAllButton:s,toggleFiltersButton:l,sidebarFilters:d}=n(o),u=[].concat(a).filter(Boolean),m=[].concat(c).filter(Boolean),w=[].concat(l).filter(Boolean);let h=d.classList.contains("is-active");const p=async t=>{const n=new URLSearchParams(window.location.search).get("sort_by"),e=[...n?[["sort_by",n]]:[]],o=t?Array.from(new FormData(t).entries()):[];i.emit("product:loading",null,{isLoading:!0});const r=new URLSearchParams([...o,...e]).toString(),{"main-collection":a}=await fetch(`${window.location.origin+window.location.pathname}?sections=main-collection&${r}`).then((t=>t.json()));i.emit("filter:render",{html:(new DOMParser).parseFromString(a,"text/html"),uri:r})};s&&s.addEventListener("click",(()=>p())),u.forEach((t=>t.addEventListener("change",(t=>p(t.target.form))))),m.forEach((t=>t.addEventListener("click",(()=>{u.filter((({name:n})=>n===t.dataset.name)).forEach((t=>{t.checked=!1})),p()})))),w.forEach((t=>t.addEventListener("click",(()=>i.emit("filters:toggle",null,!h)))));const g=(t,e)=>{const{sidebarFilters:o,overlay:i}=n(t);[o,i].forEach((t=>t.classList[e?"add":"remove"]("is-active")))};i.on("filter:render",(({html:r,uri:a})=>{i.emit("product:update",null,{html:r});const c=n(r).filters;g(c,!0),o.innerHTML=c.outerHTML,i.emit("product:loading",null,{isLoading:!1}),t(a),e()})),i.on("product:loading",((t,{isLoading:n})=>{r.classList[n?"add":"remove"]("is-loading")})),i.on("filters:toggle",((t,n)=>{h=n,g(o,n),document.body.classList[n?"add":"remove"]("overflow-hidden")}))})),i=()=>Number(new URLSearchParams(window.location.search).get("page")||1),r={collectionFilters:o,mainCollection:window.component(((o,r)=>{const{loadMore:a,productGrid:c,sortByOptions:s,sortByContainer:l,container:d}=n(o);r.on("product:update",((t,{html:e})=>{c.innerHTML=n(e).productGrid.innerHTML}));const u=async t=>{const e=i(),o=t||e+1,r=((t,n)=>{const e=new URLSearchParams(window.location.search);return e.set("page",t),e.set("sort_by",n),e.toString()})(o,s.value),c=await(async t=>fetch(t).then((t=>t.text())).then((t=>(new DOMParser).parseFromString(t,"text/html"))))(`${window.location.origin+window.location.pathname}?section_id=main-collection&${r}`);a.classList.add("opacity-0");const{empty:l}=n(c,null);if(l)return;const d=1===o;window.app.emit("product:render",null,{html:c,uri:r,addProducts:!d})},m=new IntersectionObserver((t=>{t.forEach((async t=>{t.isIntersecting&&(a.classList.remove("active"),u())}))}),{rootMargin:"0px",threshold:0});a&&m.observe(a),1!==i()&&window.addEventListener("load",(()=>{u(1),setTimeout((()=>window.scrollTo(0,0)),100)})),r.on("product:render",((o,{html:i,uri:a,addProducts:s=!1})=>{const{productGrid:l}=n(i,null);s?c.innerHTML+=l.innerHTML:c.innerHTML=l.innerHTML,[].concat(n(c).quickAddButton).filter(Boolean).forEach((t=>t.setAttribute("data-component","quickAddButton"))),t(a),r.emit("product:loading",null,{isLoading:!1}),e()})),r.on("product:loading",((t,{isLoading:n})=>{[d,l,c].forEach((t=>t.classList[n?"add":"remove"]("is-loading")))})),s.addEventListener("change",(()=>{r.emit("product:loading",null,{isLoading:!0}),u(1)}))}))};window.app.add(r),window.app.mount()})();
(()=>{"use strict";const t=async t=>fetch(t).then((t=>t.text())).then((t=>(new DOMParser).parseFromString(t,"text/html"))),e=t=>history.pushState({searchParams:t},"",`${window.location.pathname}${t.includes("?")||!t?t:"?".concat(t)}`);function n(t=document.body,e){const n=[...t.querySelectorAll(e?`[class*="${e}"]`:"*")],o=e?"classList":"dataset";return n.reduce(((t,n)=>([].slice.call(e?n[o]:Object.entries(n[o])).forEach((o=>{let a;e&&o.slice(0,e.length)===e?a=o.slice(e.length,o.length):e||([a]=o),a&&(t[a]=t.hasOwnProperty(a)?t[a].constructor===Array?t[a].concat(n):[t[a],n]:n)})),t)),{})}const o=window.component(((o,a)=>{const{sectionId:i}=o.dataset,r=()=>{const{filtersForm:e,input:r,clearButton:c,clearAllButton:s,toggleFiltersButton:d}=n(o),l=[].concat(r).filter(Boolean),u=[].concat(c).filter(Boolean),g=[].concat(d).filter(Boolean),w=async(n=!1)=>{const o=new URLSearchParams(window.location.search).get("sort_by"),r=o?{sort_by:o}:{},c=n?{}:Object.fromEntries(new FormData(e));a.emit("product:loading",null,{isLoading:!0});const s=new URLSearchParams({...c,...r}).toString(),d=await t(`${window.location.origin+window.location.pathname}?section_id=${i}&${s}`);window.app.emit(["filter:render"],{html:d,uri:s})};s&&s.addEventListener("click",(()=>w(!0))),l.forEach((t=>t.addEventListener("change",(()=>w())))),u.forEach((t=>t.addEventListener("click",(()=>{l.filter((({name:e})=>e===t.dataset.name)).forEach((t=>{t.checked=!1})),w()})))),g.forEach((t=>t.addEventListener("click",(()=>a.emit("filters:toggle")))))},c=t=>{const{sidebarFilters:e,overlay:o}=n(t);e.classList.toggle("is-active"),o.classList.toggle("is-active")};a.on("filter:render",(({html:t,uri:i})=>{console.log(i),a.emit("product:update",null,{html:t});const s=n(t).filters;c(s),o.innerHTML=n(t).filters.innerHTML,e(i),r(),a.emit("product:loading",null,{isLoading:!1})})),a.on("filters:toggle",(()=>{c(o),document.body.classList.toggle("overflow-hidden")})),r()})),a=t=>{let e,n;const o=window.location.search.substring(1).split("&");for(e=0;e<o.length;e++)if(n=o[e].split("="),n[0]===t)return parseInt(n[1],0);return 1},i={collectionFilter:o,mainCollection:window.component(((o,i)=>{const{loadMore:r,productGrid:c,sortByOptions:s,sidebarLayer:d}=n(o),l=t=>{document.querySelector(`[data-sidebar][data-id="${t}"]`).classList.toggle("is-active"),d.classList.toggle("is-active"),d.dataset.id=t},u=()=>{const{quickAddBtn:t,closeSidebarBtn:e}=n(o);(t||e)&&[].concat(t,e).forEach((t=>{t.addEventListener("click",(t=>l(t.currentTarget.dataset.id)))}))},g=()=>{const{addToCartBtn:t}=n(o);t&&[].concat(t).forEach((t=>{t.addEventListener("click",(async t=>{const{id:e}=t.currentTarget.dataset,n=t.currentTarget.closest("form"),o=new FormData(n);try{await(a=o,fetch(`${window.Shopify.routes.root}cart/add.js`,{method:"POST",body:a}).then((t=>t.json())).catch((t=>{throw new Error(t)}))),(t=>{const e=document.querySelector(`[data-quick-add-btn][data-id="${t}"]`);e.classList.add("is-active"),setTimeout((()=>{e.classList.remove("is-active")}),1500)})(e)}catch(t){console.error(t.message)}finally{l(e)}var a}))}))};d.addEventListener("click",(t=>l(t.currentTarget.dataset.id))),i.on("product:update",((t,{html:e})=>{c.innerHTML=n(e).productGrid.innerHTML,u(),g()}));const w=async e=>{const o=a("page"),i=e||o+1,c=((t,e)=>{const n=new URLSearchParams(window.location.search);return n.set("page",t),n.set("sort_by",e),n.toString()})(i,s.value),d=await t(`${window.location.origin+window.location.pathname}?section_id=main-collection&${c}`);r.classList.add("opacity-0");const{empty:l}=n(d,null);if(l)return;const u=1===i;window.app.emit(["product:render"],{html:d,uri:c,addProducts:!u})},h=new IntersectionObserver((t=>{t.forEach((async t=>{t.isIntersecting&&(r.classList.remove("active"),w())}))}),{rootMargin:"0px",threshold:0});r&&h.observe(r),1!==a("page")&&window.addEventListener("load",(()=>{w(1),setTimeout((()=>window.scrollTo(0,0)),100)})),i.on("product:render",(({html:t,uri:o,addProducts:a=!1})=>{const{productGrid:r}=n(t,null);a?c.innerHTML+=r.innerHTML:c.innerHTML=r.innerHTML,e(o),u(),g(),window.app.mount(),i.emit("product:loading",null,{isLoading:!1})})),i.on("product:loading",((t,{isLoading:e})=>{n(o).container.classList[e?"add":"remove"]("is-loading")})),s.addEventListener("change",(()=>{i.emit("product:loading",null,{isLoading:!0}),w(1)})),u(),g()}))};window.app.add(i),window.app.mount()})();
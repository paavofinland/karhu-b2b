(()=>{"use strict";const t=async t=>fetch(t).then((t=>t.text())).then((t=>(new DOMParser).parseFromString(t,"text/html"))),n=t=>history.pushState({searchParams:t},"",`${window.location.pathname}${t.includes("?")||!t?t:"?".concat(t)}`);function e(t=document.body,n){const e=[...t.querySelectorAll(n?`[class*="${n}"]`:"*")],o=n?"classList":"dataset";return e.reduce(((t,e)=>([].slice.call(n?e[o]:Object.entries(e[o])).forEach((o=>{let i;n&&o.slice(0,n.length)===n?i=o.slice(n.length,o.length):n||([i]=o),i&&(t[i]=t.hasOwnProperty(i)?t[i].constructor===Array?t[i].concat(e):[t[i],e]:e)})),t)),{})}const o=window.component(((o,i)=>{const{sectionId:r}=o.dataset,a=()=>{const{filtersForm:n,input:a,clearButton:c,clearAllButton:s,toggleFiltersButton:l}=e(o),d=[].concat(a).filter(Boolean),u=[].concat(c).filter(Boolean),p=[].concat(l).filter(Boolean),w=async(e=!1)=>{i.emit("product:loading",null,{isLoading:!0});const o=e?"":new URLSearchParams(new FormData(n)).toString(),a=await t(`${window.location.origin+window.location.pathname}?section_id=${r}&${o}`);window.app.emit(["filter:render"],{html:a,uri:o})};s&&s.addEventListener("click",(()=>w(!0))),d.forEach((t=>t.addEventListener("change",(()=>w())))),u.forEach((t=>t.addEventListener("click",(()=>{d.filter((({name:n})=>n===t.dataset.name)).forEach((t=>{t.checked=!1})),w()})))),p.forEach((t=>t.addEventListener("click",(()=>i.emit("filters:toggle")))))},c=t=>{const{sidebar:n,overlay:o}=e(t);n.classList.toggle("is-active"),o.classList.toggle("is-active")};i.on("filter:render",(({html:t,uri:r})=>{i.emit("product:update",null,{html:t});const s=e(t).filters;c(s),o.innerHTML=e(t).filters.innerHTML,n(r),a(),i.emit("product:loading",null,{isLoading:!1})})),i.on("filters:toggle",(()=>{c(o),document.body.classList.toggle("overflow-hidden")})),a()})),i=t=>{let n,e;const o=window.location.search.substring(1).split("&");for(n=0;n<o.length;n++)if(e=o[n].split("="),e[0]===t)return parseInt(e[1],0);return 1},r={collectionFilter:o,mainCollection:window.component(((o,r)=>{const{loadMore:a,sortByOptions:c,productGrid:s}=e(o);r.on("product:update",((t,{html:n})=>{s.innerHTML=e(n).productGrid.innerHTML}));const l=async n=>{const o=i("page"),r=n||o+1,s=((t,n)=>{const e=new URLSearchParams(window.location.search);return e.set("page",t),e.set("sort_by",n),e.toString()})(r,c.value),l=await t(`${window.location.origin+window.location.pathname}?section_id=main-collection&${s}`);a.classList.add("opacity-0");const{empty:d}=e(l,null);if(d)return;const u=1===r;window.app.emit(["product:render"],{html:l,uri:s,addProducts:!u})},d=new IntersectionObserver((t=>{t.forEach((async t=>{t.isIntersecting&&(a.classList.remove("active"),l())}))}),{rootMargin:"0px",threshold:0});a&&d.observe(a),1!==i("page")&&window.addEventListener("load",(()=>{l(1),setTimeout((()=>window.scrollTo(0,0)),100)})),r.on("product:render",(({html:t,uri:o,addProducts:i=!1})=>{const{productGrid:a}=e(t,null);i?s.innerHTML+=a.innerHTML:s.innerHTML=a.innerHTML,n(o),window.app.mount(),r.emit("product:loading",null,{isLoading:!1})})),r.on("product:loading",((t,{isLoading:n})=>{e(o).container.classList[n?"add":"remove"]("is-loading")})),c.addEventListener("change",(()=>{r.emit("product:loading",null,{isLoading:!0}),l(1)}))}))};window.app.add(r),window.app.mount()})();
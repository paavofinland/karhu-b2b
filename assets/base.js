<<<<<<< HEAD
(()=>{"use strict";const e=e=>new Promise((t=>{window?.hasLoaded?.scripts?.[e]?t():window.app.on(`${e}:loaded`,t)}));function t(e=document.body,t){const n=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],o=t?"classList":"dataset";return n.reduce(((e,n)=>([].slice.call(t?n[o]:Object.entries(n[o])).forEach((o=>{let s;t&&o.slice(0,t.length)===t?s=o.slice(t.length,o.length):t||([s]=o),s&&(e[s]=e.hasOwnProperty(s)?e[s].constructor===Array?e[s].concat(n):[e[s],n]:n)})),e)),{})}const n=window.component((async n=>{const{slider:o,slide:s,prev:a,next:i}=t(n,null);if(s.length>1){await e("Swiper");const t=new Swiper(o,{slidesPerView:1,loop:!0,on:{afterInit:e=>{e.wrapperEl.classList.remove("overflow-hidden","flex")}}});a.addEventListener("click",(()=>t.slidePrev())),i.addEventListener("click",(()=>t.slideNext()))}})),o=window.component((async(e,n)=>{const{editItemBtn:o,sidebar:s,sidebarLayer:a,closeSidebarBtn:i,saveCartBtn:r,popup:c,closePopupBtn:d,shareCartBtn:l}=t(e),p=Array.isArray(s)?Array.from(s):[s],u=e=>{const{id:t}=e.currentTarget.dataset;var n;p.find((n=t,e=>e.dataset.id===n)).classList.toggle("is-active"),a.classList.toggle("is-active"),a.dataset.id=t,document.body.classList.toggle("overflow-hidden")};o&&[].concat(o).forEach((e=>e.addEventListener("click",u))),i&&[].concat(i).forEach((e=>e.addEventListener("click",u))),a.addEventListener("click",u);const w=()=>n.emit("popup:close",null,"save-cart");r&&r.addEventListener("click",(()=>n.emit("popup:open",null,"save-cart"))),d&&[].concat(d).forEach((e=>e.addEventListener("click",w))),l&&l.addEventListener("click",(async()=>{const n=(e=>{const t=encodeURIComponent(JSON.stringify(e));return`${window.location.origin}/pages/share-cart?data=${t}`})((()=>{const{item:n,subtotal:o}=t(e,null),s={subtotal:o.dataset.subtotal,items:[]};return[].concat(n).forEach((e=>{const{item:t,...n}=e.dataset;s.items.push(n)})),s})());await navigator.clipboard.writeText(n),l.innerText="Link Copied",l.classList.add("is-active")}))})),s=e=>{console.error("Error:",e),document.body.classList.remove("pointer-events-none")},a=window.component((async(e,n)=>{const{productTemplate:o,productContainer:a,loader:i,section:r,addToBagBtn:c,closePopupBtn:d,addToBagPopupBtn:l,addToBagForm:p}=t(e);n.on("cart:loaded",(()=>{i.classList.add("hidden"),r.classList.remove("hidden")})),n.on("data:render",((s,{subtotal:i,items:r})=>{const{subtotal:c}=t(e,null);c.innerText=i,(e=>{a.innerHTML="";const n=document.createDocumentFragment();e.forEach((({title:e,price:s,quantity:a,image:i,id:r})=>{const c=o.content.cloneNode(!0),{titleElem:d,priceElem:l,quantityElem:p,imageElem:u,item:w,inputId:m,inputQuantity:g}=t(c,null);w.dataset.id=r,d.innerText=e,d.setAttribute("title",e),l.innerText=s,p.innerText=a,u.src=i,m.value=r,g.value=a,n.appendChild(c)})),a.appendChild(n)})(r),n.emit("cart:loaded"),n.emit("data:update",null,r)}));const u=new URL(window.location.href).searchParams.get("data");n.emit("data:render",null,JSON.parse(u));const w=()=>n.emit("popup:close",null,"add-to-bag");c&&c.addEventListener("click",(()=>n.emit("popup:open",null,"add-to-bag"))),d&&[].concat(d).forEach((e=>e.addEventListener("click",w))),l&&l.addEventListener("click",(async()=>{l.classList.add("is-active"),document.body.classList.add("pointer-events-none"),await fetch(`${window.Shopify.routes.root}cart/clear.js`,{method:"POST"}).then((e=>e.json())).catch(s);const e=new FormData(p);var t;await(t=e,fetch(`${window.Shopify.routes.root}cart/add.js`,{method:"POST",body:t}).then((e=>e.json())).catch(s)),window.location.replace(`${window.location.origin}/cart`)}))})),i=window.component((async n=>{const{slider:o}=t(n,null);return await e("Swiper"),new Swiper(o,{slidesPerView:1.4,spaceBetween:16,slidesOffsetBefore:16,slidesOffsetAfter:16,breakpoints:{768:{slidesPerView:2.2,spaceBetween:16,slidesOffsetBefore:16,slidesOffsetAfter:16},1024:{slidesPerView:2.4,spaceBetween:60,slidesOffsetBefore:0,slidesOffsetAfter:0},1440:{slidesPerView:3,spaceBetween:60,slidesOffsetBefore:0,slidesOffsetAfter:0}}})})),r=e=>{let t,n;const o=window.location.search.substring(1).split("&");for(t=0;t<o.length;t++)if(n=o[t].split("="),n[0]===e)return n[1];return null},c=e=>history.pushState({searchParams:e},"",`${window.location.pathname}${e.includes("?")?e:"?".concat(e)}`),d=({page:e,q:t,sortBy:n})=>{const o=new URLSearchParams(window.location.search);return o.set("page",e),o.set("q",t),o.set("sort_by",n),o},l=e=>function(e,t=300){let n;return(...o)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(this,o)}),t)}}((async t=>{const{page:n,q:o,sortBy:s}=(({page:e,q:t,sortBy:n})=>({page:e||r("page"),q:t||r("q"),sortBy:n||r("sort_by")}))(t),a=d({page:n,q:o,sortBy:s});a.set("sectionId",e),a.set("type","product");const i=a.toString(),c=await(async e=>fetch(e).then((e=>e.text())).then((e=>(new DOMParser).parseFromString(e,"text/html"))))(`${window.location.origin+window.location.pathname}?${i}`);window.app.emit(["search:render"],null,{html:c,uri:i,requestedPage:n})})),p={hero:n,cart:o,shareCart:a,categoryOverview:i,search:window.component((async(e,n)=>{const{searchInput:o,searchContainer:s,sortByOptions:a}=t(e,null),i=l(e.dataset.sectionId),p=new IntersectionObserver((e=>{e.forEach((async e=>{if(e.isIntersecting){const e=r("page");i({q:o.value,page:+e+1})}}))}),{rootMargin:"0px",threshold:[0,.25,.5,.75,1]}),u=()=>{const{searchResults:n,loader:o}=t(e,null);o.classList.add("hidden"),n.classList.remove("hidden")},w=n=>{if(s.classList[n?"add":"remove"]("is-active"),n)return i({q:n,page:1}),void(()=>{const{searchResults:n,loader:o,empty:s}=t(e,null);s.classList.add("hidden"),o.classList.remove("hidden"),n.classList.add("hidden")})();const o=d({page:1,q:"",sortBy:a.value}).toString();c(o)};o.addEventListener("input",(e=>w(e.target.value))),a.addEventListener("change",(n=>{const{productsContainer:s}=t(e,null);s.classList.add("is-loading");const a=n.target.value;i({q:o.value,page:r("page"),sortBy:a})})),n.on("search:render",((n,{html:o,uri:s,requestedPage:a})=>{(n=>{const{productsCount:o}=t(e,null),{productsCount:s}=t(n,null);o.innerHTML=s.innerHTML})(o);const{searchResults:i}=t(o,null),{empty:d,productsContainer:l}=t(e,null);if(l.classList.remove("is-loading"),!i.childNodes.length)return 1===a&&((()=>{const{searchResults:n}=t(e,null);n.innerHTML=""})(),d.classList.remove("hidden")),void u();c(s),(n=>{const o=r("page"),{searchResults:s}=t(e,null),{searchResults:a}=t(n,null);"1"!==o?s.insertAdjacentHTML("beforeEnd",a.innerHTML):s.innerHTML=a.innerHTML})(o),d.classList.add("hidden"),1===a&&((()=>{const{loadMore:n}=t(e,null);n&&p.observe(n)})(),u()),window.app.mount()}));const m=r("page"),g=r("q");(m&&"1"!==m||g)&&(s.classList.add("is-active"),o.value=g,w(g),setTimeout((()=>window.scrollTo(0,0)),100))}))},u=window.component((()=>{document.addEventListener("shopify:section:load",(()=>{window.app.unmount(),window.app.mount()}))})),w=window.component((e=>{const{text:t}=e.dataset;console.log("console:log",t)})),m=window.component(((e,n)=>{const{group:o}=e.dataset,{inner:s,toggle:a,shrinkBtn:i,expandBtn:r,toggleModalBtn:c}=t(e,null),d="is-active",l=()=>{e.style.setProperty("--innerHeight","auto"),e.style.setProperty("--innerHeight",`${s.scrollHeight}px`)};l(),window.addEventListener("resize",l,{passive:!0}),a.addEventListener("click",(()=>{n.emit("accordion:toggle",null,{open:!e.classList.contains(d),node:e,group:o})})),c&&c.addEventListener("click",(e=>{n.emit("modal:open",{type:e.target.dataset.modalType})})),n.on("accordion:toggle",((t,n={})=>{o===n.group&&(e.classList[n.open&&n.node===e?"add":"remove"](d),i.classList.toggle("hidden"),i.classList.toggle("flex"),r.classList.toggle("hidden"),r.classList.toggle("block"))}))})),g=window.component((e=>{const{hamburger:n,hamburgerOpened:o,hamburgerClosed:s,mobileMenu:a,main:i}=t(e),{clear:r}=e.dataset,c=document.querySelector("#shopify-section-announcement-bar").offsetHeight||0,d=()=>{void 0!==r&&i.classList[!o.classList.contains("hidden")||window.scrollY>c?"add":"remove"]("is-active")};window.addEventListener("scroll",d,{passive:!0}),window.addEventListener("load",d),n.addEventListener("click",(()=>{o.classList.toggle("hidden"),s.classList.toggle("hidden"),document.body.classList.toggle("overflow-hidden"),a.classList.toggle("left-0"),d()}));const l=()=>{a.style.height=window.innerHeight-c-a.parentElement.offsetHeight+"px"};l(),window.addEventListener("resize",l)}));const h=({keyCode:e},{type:t,boolean:n})=>{27===e&&t&&n&&window.app.emit(t,{[n]:!1})},v=window.component((async(e,n)=>{const o=e.parentNode,s=e,{toggle:a,clear:i,focusEl:r}=t(e,null),c=({cartOpen:t})=>{e.classList[t?"add":"remove"]("open"),t?(s.tabIndex="0",(r||e).focus()):s.tabIndex="-1"};return a.forEach((e=>{e.addEventListener("click",(()=>n.emit("cart:toggle",(({cartOpen:e})=>({cartOpen:!e??!0})))))})),c(n.getState()),i&&i.addEventListener("click",(()=>(window.app.emit("cart:updating"),fetch(`${window.Phill.routes.cartClear}.js`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:"cart-drawer"})}).then((e=>e.json())).then((e=>(window.app.emit(["cart:updated","cart:render"],{cart:e}),e)))))),e.addEventListener("keyup",(e=>h(e,{type:"cart:toggle",boolean:"cartOpen"}))),await n.on("cart:render",(({cart:e})=>{o&&(document.getElementById("shopify-section-cart-drawer").outerHTML=e.sections["cart-drawer"]),window.app.unmount(),window.app.mount()})),n.on("cart:toggle",c),()=>{n.on(["cart:toggle","cart:render"],(()=>{}))(),e.removeEventListener("keyup",(e=>h(e,{type:"cart:toggle",boolean:"cartOpen"})))}})),L=window.component((e=>{const{update:n}=t(e,null),{key:o}=e.dataset;[].concat(n).forEach((e=>{const{value:t}=e.dataset;e.addEventListener("click",(()=>function(e,t){return function(e,t){return window.app.emit("cart:updating"),fetch(`${window.Phill.routes.cartChange}.js`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:t,sections:"cart-drawer"})}).then((e=>e.json())).then((async e=>(window.app.emit(["cart:updated","cart:render"],{cart:e}),e)))}(e,t)}(o,t)))}))})),f="agent-stores:loading",y={sectionRendering:u,consoleLog:w,accordion:m,header:g,cartDrawer:v,cartItem:L,announcementBar:window.component((async(e,n)=>{const{selectCustomer:o}=t(e,null),{select:s}=t(o,null),{customerId:a,customerSecret:i,store:r,selectedStoreCustomer:c}=e.dataset;if(!(a&&i&&r&&o))return;n.on(f,((e,t=!0)=>{o.classList[t?"add":"remove"]("is-loading")})),n.emit(f,null,!0);const d=new URLSearchParams({store:r,customerId:a,secret:i}),l=await fetch(`https://karhu-b2b-functions.vercel.app/api/customer/list-agent-stores?${d}`).then((async e=>{if(200===e.status){const t=await e.json();return n.emit("agent-stores:received",null,{data:t}),t}return console.error(`Could not fetch agent stores [${(await e.json()).message}]`),[]}));n.emit(f,null,!1),l.length?((e=>{const t=document.createDocumentFragment();e.forEach((e=>{const n=document.createElement("option");c===e.id&&n.setAttribute("selected",!0),n.value=e.id,n.innerText=e.name,t.appendChild(n)})),s.appendChild(t)})(l),s.addEventListener("change",(async e=>{n.emit(f,null,!0),await fetch(`https://karhu-b2b-functions.vercel.app/api/customer/set-selected-store?${d}&storeCustomerId=${e.target.value}`).then((async e=>{201===e.status?window.location.reload():console.error(`Could not set selected store [${(await e.json()).message}]`)})),n.emit(f,null,!1)})),n.emit("store-data:send",null,{data:e.dataset})):s.setAttribute("disabled",!0)})),modal:window.component(((e,n)=>{const{closeModalBtn:o}=t(e,null),s=()=>{e.classList.toggle("flex"),e.classList.toggle("hidden"),document.body.classList.toggle("overflow-hidden")};e.addEventListener("click",(e=>{e.target.dataset.modalType&&s()}),{capture:!0}),o.addEventListener("click",s),n.on("modal:open",(t=>{e.dataset.modalType===t.type&&s()}))})),countrySelect:window.component((e=>{const{select:n}=t(e),o=new URLSearchParams(window.location.search).get("country_code"),s=n.dataset.current;o&&o!==s&&(n.value=o,n.form.submit()),n.addEventListener("change",(e=>{const t=e.target.options[e.target.selectedIndex];t.dataset.url?window.location.href=`${t.dataset.url}?country_code=${t.value}`:e.target.form.submit()}))})),popup:window.component(((e,n)=>{const{popupOverlay:o}=t(e,null),s=()=>{e.classList.add("hidden"),document.body.classList.remove("overflow-hidden")};n.on("popup:open",((t,n)=>{e.dataset.popup===n&&(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))})),n.on("popup:close",((t,n)=>{e.dataset.popup===n&&s()})),o.addEventListener("click",(e=>{e.currentTarget.dataset.popupOverlay&&s()}))}))};window.app.add(p),window.app.add(y),window.app.mount()})();
=======
(()=>{"use strict";const e=e=>new Promise((t=>{window?.hasLoaded?.scripts?.[e]?t():window.app.on(`${e}:loaded`,t)}));function t(e=document.body,t){const n=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],s=t?"classList":"dataset";return n.reduce(((e,n)=>([].slice.call(t?n[s]:Object.entries(n[s])).forEach((s=>{let o;t&&s.slice(0,t.length)===t?o=s.slice(t.length,s.length):t||([o]=s),o&&(e[o]=e.hasOwnProperty(o)?e[o].constructor===Array?e[o].concat(n):[e[o],n]:n)})),e)),{})}const n=window.component((async n=>{const{slider:s,slide:o,prev:a,next:r}=t(n,null);if(o.length>1){await e("Swiper");const t=new Swiper(s,{slidesPerView:1,loop:!0,on:{afterInit:e=>{e.wrapperEl.classList.remove("overflow-hidden","flex")}}});a.addEventListener("click",(()=>t.slidePrev())),r.addEventListener("click",(()=>t.slideNext()))}})),s=window.component((async e=>{const{editItemBtn:n,sidebar:s,sidebarLayer:o,closeSidebarBtn:a,saveCartBtn:r,popup:i,closePopupBtn:c}=t(e),d=Array.isArray(s)?Array.from(s):[s],l=e=>{const{id:t}=e.currentTarget.dataset;var n;d.find((n=t,e=>e.dataset.id===n)).classList.toggle("is-active"),o.classList.toggle("is-active"),document.body.classList.toggle("overflow-hidden")};n.addEventListener("click",l),a.addEventListener("click",l),o.addEventListener("click",l);const u=()=>i.classList.toggle("hidden");r.addEventListener("click",u),c.forEach((e=>e.addEventListener("click",u)))})),o=window.component((async n=>{const{slider:s}=t(n,null);return await e("Swiper"),new Swiper(s,{slidesPerView:1.4,spaceBetween:16,slidesOffsetBefore:16,slidesOffsetAfter:16,breakpoints:{768:{slidesPerView:2.2,spaceBetween:16,slidesOffsetBefore:16,slidesOffsetAfter:16},1024:{slidesPerView:2.4,spaceBetween:60,slidesOffsetBefore:0,slidesOffsetAfter:0},1440:{slidesPerView:3,spaceBetween:60,slidesOffsetBefore:0,slidesOffsetAfter:0}}})})),a=e=>{let t,n;const s=window.location.search.substring(1).split("&");for(t=0;t<s.length;t++)if(n=s[t].split("="),n[0]===e)return n[1];return null},r=e=>history.pushState({searchParams:e},"",`${window.location.pathname}${e.includes("?")?e:"?".concat(e)}`),i=({page:e,q:t,sortBy:n})=>{const s=new URLSearchParams(window.location.search);return s.set("page",e),s.set("q",t),s.set("sort_by",n),s},c=e=>function(e,t=300){let n;return(...s)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(this,s)}),t)}}((async t=>{const{page:n,q:s,sortBy:o}=(({page:e,q:t,sortBy:n})=>({page:e||a("page"),q:t||a("q"),sortBy:n||a("sort_by")}))(t),r=i({page:n,q:s,sortBy:o});r.set("sectionId",e),r.set("type","product");const c=r.toString(),d=await(async e=>fetch(e).then((e=>e.text())).then((e=>(new DOMParser).parseFromString(e,"text/html"))))(`${window.location.origin+window.location.pathname}?${c}`);window.app.emit(["search:render"],null,{html:d,uri:c,requestedPage:n})})),d={hero:n,cart:s,categoryOverview:o,search:window.component((async(e,n)=>{const{searchInput:s,searchContainer:o,sortByOptions:d}=t(e,null),l=c(e.dataset.sectionId),u=new IntersectionObserver((e=>{e.forEach((async e=>{if(e.isIntersecting){const e=a("page");l({q:s.value,page:+e+1})}}))}),{rootMargin:"0px",threshold:[0,.25,.5,.75,1]}),p=()=>{const{searchResults:n,loader:s}=t(e,null);s.classList.add("hidden"),n.classList.remove("hidden")},w=n=>{if(o.classList[n?"add":"remove"]("is-active"),n)return l({q:n,page:1}),void(()=>{const{searchResults:n,loader:s,empty:o}=t(e,null);o.classList.add("hidden"),s.classList.remove("hidden"),n.classList.add("hidden")})();const s=i({page:1,q:"",sortBy:d.value}).toString();r(s)};s.addEventListener("input",(e=>w(e.target.value))),d.addEventListener("change",(n=>{const{productsContainer:o}=t(e,null);o.classList.add("is-loading");const r=n.target.value;l({q:s.value,page:a("page"),sortBy:r})})),n.on("search:render",((n,{html:s,uri:o,requestedPage:i})=>{(n=>{const{productsCount:s}=t(e,null),{productsCount:o}=t(n,null);s.innerHTML=o.innerHTML})(s);const{searchResults:c}=t(s,null),{empty:d,productsContainer:l}=t(e,null);if(l.classList.remove("is-loading"),!c.childNodes.length)return 1===i&&((()=>{const{searchResults:n}=t(e,null);n.innerHTML=""})(),d.classList.remove("hidden")),void p();r(o),(n=>{const s=a("page"),{searchResults:o}=t(e,null),{searchResults:r}=t(n,null);"1"!==s?o.insertAdjacentHTML("beforeEnd",r.innerHTML):o.innerHTML=r.innerHTML})(s),d.classList.add("hidden"),1===i&&((()=>{const{loadMore:n}=t(e,null);n&&u.observe(n)})(),p()),window.app.mount()}));const g=a("page"),h=a("q");(g&&"1"!==g||h)&&(o.classList.add("is-active"),s.value=h,w(h),setTimeout((()=>window.scrollTo(0,0)),100))}))},l=window.component((()=>{document.addEventListener("shopify:section:load",(()=>{window.app.unmount(),window.app.mount()}))})),u=window.component((e=>{const{text:t}=e.dataset;console.log("console:log",t)})),p=window.component(((e,n)=>{const{group:s}=e.dataset,{inner:o,toggle:a,shrinkBtn:r,expandBtn:i,toggleModalBtn:c}=t(e,null),d="is-active",l=()=>{e.style.setProperty("--innerHeight","auto"),e.style.setProperty("--innerHeight",`${o.scrollHeight}px`)};l(),window.addEventListener("resize",l,{passive:!0}),a.addEventListener("click",(()=>{n.emit("accordion:toggle",null,{open:!e.classList.contains(d),node:e,group:s})})),c&&c.addEventListener("click",(e=>{n.emit("modal:open",{type:e.target.dataset.modalType})})),n.on("accordion:toggle",((t,n={})=>{s===n.group&&(e.classList[n.open&&n.node===e?"add":"remove"](d),r.classList.toggle("hidden"),r.classList.toggle("flex"),i.classList.toggle("hidden"),i.classList.toggle("block"))}))})),w=window.component((e=>{const{hamburger:n,hamburgerOpened:s,hamburgerClosed:o,mobileMenu:a,main:r}=t(e),{clear:i}=e.dataset,c=document.querySelector("#shopify-section-announcement-bar").offsetHeight||0,d=()=>{void 0!==i&&r.classList[!s.classList.contains("hidden")||window.scrollY>c?"add":"remove"]("is-active")};window.addEventListener("scroll",d,{passive:!0}),window.addEventListener("load",d),n.addEventListener("click",(()=>{s.classList.toggle("hidden"),o.classList.toggle("hidden"),document.body.classList.toggle("overflow-hidden"),a.classList.toggle("left-0"),d()}));const l=()=>{a.style.height=window.innerHeight-c-a.parentElement.offsetHeight+"px"};l(),window.addEventListener("resize",l)}));const g=({keyCode:e},{type:t,boolean:n})=>{27===e&&t&&n&&window.app.emit(t,{[n]:!1})},h=window.component((async(e,n)=>{const s=e.parentNode,o=e,{toggle:a,clear:r,focusEl:i}=t(e,null),c=({cartOpen:t})=>{e.classList[t?"add":"remove"]("open"),t?(o.tabIndex="0",(i||e).focus()):o.tabIndex="-1"};return a.forEach((e=>{e.addEventListener("click",(()=>n.emit("cart:toggle",(({cartOpen:e})=>({cartOpen:!e??!0})))))})),c(n.getState()),r&&r.addEventListener("click",(()=>(window.app.emit("cart:updating"),fetch(`${window.Phill.routes.cartClear}.js`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:"cart-drawer"})}).then((e=>e.json())).then((e=>(window.app.emit(["cart:updated","cart:render"],{cart:e}),e)))))),e.addEventListener("keyup",(e=>g(e,{type:"cart:toggle",boolean:"cartOpen"}))),await n.on("cart:render",(({cart:e})=>{s&&(document.getElementById("shopify-section-cart-drawer").outerHTML=e.sections["cart-drawer"]),window.app.unmount(),window.app.mount()})),n.on("cart:toggle",c),()=>{n.on(["cart:toggle","cart:render"],(()=>{}))(),e.removeEventListener("keyup",(e=>g(e,{type:"cart:toggle",boolean:"cartOpen"})))}})),m=window.component((e=>{const{update:n}=t(e,null),{key:s}=e.dataset;[].concat(n).forEach((e=>{const{value:t}=e.dataset;e.addEventListener("click",(()=>function(e,t){return function(e,t){return window.app.emit("cart:updating"),fetch(`${window.Phill.routes.cartChange}.js`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:t,sections:"cart-drawer"})}).then((e=>e.json())).then((async e=>(window.app.emit(["cart:updated","cart:render"],{cart:e}),e)))}(e,t)}(s,t)))}))})),y=window.component(((e,n)=>{const{closeModalBtn:s}=t(e,null),o=()=>{e.classList.toggle("flex"),e.classList.toggle("hidden"),document.body.classList.toggle("overflow-hidden")};e.addEventListener("click",(e=>{e.target.dataset.modalType&&o()}),{capture:!0}),s.addEventListener("click",o),n.on("modal:open",(t=>{e.dataset.modalType===t.type&&o()}))})),v=window.component(((e,n)=>{const{select:s}=t(e),o=new URLSearchParams(window.location.search).get("country_code"),a=s.dataset.current,r=s.dataset.default,i=()=>{const e=s.options[s.selectedIndex];e.dataset.url?window.location.href=`${e.dataset.url}?country_code=${e.value}`:s.form.submit()};r&&a!==r?(s.value=r,i()):o&&o!==a&&(s.value=o,i()),n.on("store:change",((e,{countryCode:t})=>{t!==a&&(s.value=t,i())})),s.addEventListener("change",(()=>i()))})),L="agent-stores:loading",f={sectionRendering:l,consoleLog:u,accordion:p,header:w,cartDrawer:h,cartItem:m,modal:y,countrySelect:v,storeSelect:window.component((async(e,n)=>{const{store:{store:s},customer:{secret:o,selected_store_customer:a,id:r}}=JSON.parse(document.querySelector("script#liquid-variables").innerHTML),{selectCustomer:i}=t(e,null),{select:c}=t(i,null);n.on(L,((e,t=!0)=>{c.classList[t?"add":"remove"]("is-loading"),c.disabled=t})),n.emit(L,null,!0);const d=new URLSearchParams({store:s,customerId:r,secret:o});c.addEventListener("change",(async e=>{n.emit(L,null,!0),await fetch(`https://karhu-b2b-functions.vercel.app/api/customer/set-selected-store?${d}&storeCustomerId=${e.target.value}`).then((async e=>{201!==e.status&&console.error(`Could not set selected store [${(await e.json()).message}]`)})),n.emit(L,null,!1),n.emit("store:change",null,{countryCode:e.target.options[e.target.selectedIndex].dataset.countryCode})})),await(async()=>{const e=await(async(e,t,n)=>{const s=new URLSearchParams({store:e,customerId:t,secret:n});return fetch(`https://karhu-b2b-functions.vercel.app/api/customer/list-agent-stores?${s}`).then((async e=>200===e.status?await e.json():(console.error(`Could not fetch agent stores [${(await e.json()).message}]`),[])))})(s,r,o);n.emit(L,null,!1),n.emit("agent-stores:received",null,{data:e}),e.length?(e=>{const t=document.createDocumentFragment();e.forEach((e=>{const n=document.createElement("option");a===e.id&&n.setAttribute("selected",!0),n.value=e.id,n.innerText=e.name,n.setAttribute("data-country-code",e.countryCode),t.appendChild(n)})),c.appendChild(t)})(e):c.setAttribute("disabled",!0)})()}))};window.app.add(d),window.app.add(f),window.app.mount()})();
>>>>>>> origin/main

(()=>{"use strict";const t=async t=>fetch(t).then((t=>t.text())).then((t=>(new DOMParser).parseFromString(t,"text/html"))),e=t=>history.pushState({searchParams:t},"",`${window.location.pathname}${t.includes("?")||!t?t:"?".concat(t)}`);function n(t=document.body,e){const n=[...t.querySelectorAll(e?`[class*="${e}"]`:"*")],o=e?"classList":"dataset";return n.reduce(((t,n)=>([].slice.call(e?n[o]:Object.entries(n[o])).forEach((o=>{let i;e&&o.slice(0,e.length)===e?i=o.slice(e.length,o.length):e||([i]=o),i&&(t[i]=t.hasOwnProperty(i)?t[i].constructor===Array?t[i].concat(n):[t[i],n]:n)})),t)),{})}const o=window.component(((o,i)=>{const{sectionId:r}=o.dataset,a=()=>{const{filtersForm:e,input:a,clearButton:c,clearAllButton:s,toggleFiltersButton:l}=n(o),d=[].concat(a).filter(Boolean),u=[].concat(c).filter(Boolean),p=[].concat(l).filter(Boolean),w=async(n=!1)=>{i.emit("product:loading",null,{isLoading:!0});const o=n?"":new URLSearchParams(new FormData(e)).toString(),a=await t(`${window.location.origin+window.location.pathname}?section_id=${r}&${o}`);window.app.emit(["filter:render"],{html:a,uri:o})};s&&s.addEventListener("click",(()=>w(!0))),d.forEach((t=>t.addEventListener("change",(()=>w())))),u.forEach((t=>t.addEventListener("click",(()=>{d.filter((({name:e})=>e===t.dataset.name)).forEach((t=>{t.checked=!1})),w()})))),p.forEach((t=>t.addEventListener("click",(()=>i.emit("filters:toggle")))))},c=t=>{const{sidebar:e,overlay:o}=n(t);e.classList.toggle("is-active"),o.classList.toggle("is-active")};i.on("filter:render",(({html:t,uri:r})=>{i.emit("product:update",null,{html:t});const s=n(t).filters;c(s),o.innerHTML=n(t).filters.innerHTML,e(r),a(),i.emit("product:loading",null,{isLoading:!1})})),i.on("filters:toggle",(()=>{c(o),document.body.classList.toggle("overflow-hidden")})),i.on("product:loading",((t,{isLoading:e})=>{n(o).filtersForm.classList[e?"add":"remove"]("is-loading")})),a()})),i=t=>{let e,n;const o=window.location.search.substring(1).split("&");for(e=0;e<o.length;e++)if(n=o[e].split("="),n[0]===t)return parseInt(n[1],0);return 1},r={collectionFilter:o,mainCollection:window.component(((o,r)=>{const{loadMore:a,productGrid:c}=n(o),s="[data-product-grid]";r.on("product:update",((t,{html:e})=>{c.innerHTML=n(e).productGrid.innerHTML}));const l=async e=>{const n=i("page"),o=e||n+1,r=new URLSearchParams(window.location.search);r.set("page",o);const c=r.toString(),s=await t(`${window.location.origin+window.location.pathname}?section_id=main-collection&${c}`);if(a.classList.add("opacity-0"),s.querySelector("[data-empty]"))return;const l=1===o;window.app.emit(["product:render"],{html:s,uri:c,addProducts:!l})},d=new IntersectionObserver((t=>{t.forEach((async t=>{t.isIntersecting&&(a.classList.remove("active"),l())}))}),{rootMargin:"0px",threshold:0});a&&d.observe(a),1!==i("page")&&window.addEventListener("load",(()=>{l(1),setTimeout((()=>window.scrollTo(0,0)),100)})),r.on("product:render",(({html:t,uri:n,addProducts:o=!1})=>{o?c.innerHTML+=t.querySelector(s).innerHTML:c.innerHTML=t.querySelector(s).innerHTML,e(n),window.app.mount()})),r.on("product:loading",((t,{isLoading:e})=>{n(o).productGrid.classList[e?"add":"remove"]("is-loading")}))}))};window.app.add(r),window.app.mount()})();
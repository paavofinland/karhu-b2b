(()=>{"use strict";function e(e=document.body,t){const s=[...e.querySelectorAll(t?`[class*="${t}"]`:"*")],n=t?"classList":"dataset";return s.reduce(((e,s)=>([].slice.call(t?s[n]:Object.entries(s[n])).forEach((n=>{let d;t&&n.slice(0,t.length)===t?d=n.slice(t.length,n.length):t||([d]=n),d&&(e[d]=e.hasOwnProperty(d)?e[d].constructor===Array?e[d].concat(s):[e[d],s]:s)})),e)),{})}const t=window.component((t=>{const{loginForm:s,recoverPasswordForm:n,toggleRecoverPasswordBtns:d,recoverMessageSent:a,recoverPasswordSuccess:c,emailList:o}=e(t,null),r=()=>{s.classList.toggle("hidden"),n.classList.toggle("hidden")};d.forEach((e=>{e.addEventListener("click",r)}));const i=()=>{const e=document.querySelector(".errors");e&&(e.style.display="none")};o.forEach((e=>{e.addEventListener("focus",i),e.addEventListener("keyup",i)})),(()=>{const{hash:e}=window.location;return"#recover"===e})()&&!a&&r(),a&&(s.classList.add("hidden"),n.classList.add("hidden"),c.classList.remove("hidden"))})),s=window.component((t=>{const{addAddressButton:s,resetPageButton:n,editAddressButton:d,addAddress:a,info:c,addresses:o,editAddresses:r,editAddressForm:i,makeDefaultButton:l,tabLink:u,tab:h}=e(t,null),m=[].concat(h).filter(Boolean),L=[].concat(u).filter(Boolean),v=m.map((e=>e.dataset.tab)),p=new URLSearchParams(window.location.search).get("t"),f=p&&v.includes(p)?p:v[0];m.forEach((e=>e.classList[f===e.dataset.tab?"remove":"add"]("hidden"))),L.forEach((e=>e.classList[f===e.dataset.tabLink?"add":"remove"]("is-active")));const w=e=>{e.preventDefault(),c.classList.remove("hidden"),o.classList.remove("hidden"),a.classList.add("hidden"),r.classList.add("hidden"),[].concat(i).forEach((e=>e.classList.add("hidden"))),window.scrollTo(0,0)};s&&s.addEventListener("click",(e=>{e.preventDefault(),a.classList.remove("hidden"),c.classList.add("hidden"),o.classList.add("hidden"),window.scrollTo(0,0)})),n&&[].concat(n).forEach((e=>{e.addEventListener("click",w)})),d&&[].concat(d).forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const{addressId:s}=e.dataset;o.classList.add("hidden"),c.classList.add("hidden");const n=[].concat(i).find((e=>e.dataset.addressId===s));r.classList.remove("hidden"),n.classList.remove("hidden"),window.scrollTo(0,0)}))})),l&&[].concat(l).forEach((e=>{e.addEventListener("click",(e=>{const{addressId:t}=e.target.dataset,s=i.find((e=>e.dataset.addressId===t)).querySelector("form");s.querySelector('input[type="checkbox"]').click(),s.submit()}))}))})),n=window.component((t=>{const{deleteAddressButton:s,deleteAddressModal:n,closeModal:d,deleteAddressConfirm:a}=e(t,null);d&&[].concat(d).forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),n.classList.remove("open")})))),s&&s.addEventListener("click",(e=>{e.preventDefault(),n.classList.add("open")})),a&&a.addEventListener("click",(()=>{document.getElementById(`delete-address-form--${a.dataset.addressId}`).submit()}))})),d=async(e,t)=>fetch(`https://karhu-b2b-functions.vercel.app/api${e}`,t).then((async e=>{const t=await(async e=>e.json().catch((e=>null)))(e);if(!e.ok||e.status>=400&&e.status<500&&404!==e.status)throw Error(t.message||"Something went wrong, please try again later.");return t})).catch((t=>{throw console.info(`⚡️⚠️ Function error [${e}]`),t}));function a(){return JSON.parse(document.querySelector("script#liquid-variables").innerHTML)}const c={login:t,account:s,address:n,accountOrders:window.component((async(t,s)=>{const{store:{store:n,currencies:c},customer:{secret:o,id:r}}=a(),{selectCustomer:i,ordersContainer:l,noOrders:u,customerSelectText:h,ordersTable:m,ordersTableRow:L,ordersBlockContainer:v,ordersBlock:p,orders:f}=e(t),w=({container:t,containerItem:s,orderList:n})=>{t.innerHTML="";const d=document.createDocumentFragment();n.forEach((t=>{const n=s.content.cloneNode(!0);Object.entries(t).map((([e,t])=>"currencyCode"===e?[e,c.find((({iso_code:e})=>e===t))?.symbol||t]:[e,t])).forEach((([t,s])=>{[].concat(e(n)[t]).filter(Boolean).forEach((e=>{e instanceof HTMLAnchorElement?e.href=s:e.innerText=s}))})),d.appendChild(n)})),t.appendChild(d)},g=async e=>{if(""===e)u.classList.add("hidden"),h.classList.remove("hidden"),f.classList.add("hidden");else{u.classList.add("hidden"),l.classList.add("hidden"),f.classList.add("is-active"),f.classList.remove("hidden"),h&&h.classList.add("hidden");const t=await(async e=>{const t=new URLSearchParams({store:n,secret:o,customerId:r,selectedCustomerId:e||""});return d(`/customer/get-store-customer-orders?${t}`).catch((e=>(console.info("[unhandled error]"),[])))})(e);if(f.classList.remove("is-active"),!t.length)return void u.classList.remove("hidden");l.classList.remove("hidden"),w({container:m,containerItem:L,orderList:t}),w({container:v,containerItem:p,orderList:t})}};if(i){const{select:t}=e(i);t.classList.add("is-loading"),t.disabled=!0,t.addEventListener("change",(e=>g(e.target.value))),s.on("agent-stores:received",((e,{data:s})=>{t.classList.add("is-active"),t.removeAttribute("disabled"),t.classList.remove("is-loading"),t.disabled=!1;const n=document.createDocumentFragment();s.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.innerText=e.name,n.appendChild(t)})),t.appendChild(n)}))}else g()})),accountCartTemplates:window.component(((t,s)=>{window.location.search.includes("menu=carts")&&t.classList.remove("hidden");const{store:{store:n},customer:{secret:c,id:o}}=a(),{deleteCartBtn:r,deleteCartPopupBtn:i,cart:l,cartsLength:u,cartsCount:h,container:m,empty:L}=e(t,null),v=e=>{e.target.classList.toggle("is-active"),document.body.classList.toggle("pointer-events-none")};r&&[].concat(r).forEach((e=>e.addEventListener("click",(e=>{i.dataset.id=e.currentTarget.dataset.id,s.emit("popup:open",null,"delete-cart")})))),i&&i.addEventListener("click",(async e=>{const t=i.dataset.id,a=(e=>new URLSearchParams({store:n,secret:c,customerId:o,cartId:encodeURI(e)}))(t);v(e),await d(`/customer/delete-cart?${a}`,{method:"POST"}).catch((e=>{console.info("[unhandled error]")})),(e=>{[].concat(l).filter((t=>t.dataset.cart===e)).forEach((e=>e.remove()))})(t),0===(()=>{const e=parseFloat(u.innerText)-1;return e>0?u.innerText=e:h.classList.add("hidden"),e})()&&(L.classList.remove("hidden"),[].concat(m).forEach((e=>e.remove()))),i.dataset.id="",s.emit("popup:close",null,"delete-cart"),v(e)}))}))};window.app.add(c),window.app.mount()})();